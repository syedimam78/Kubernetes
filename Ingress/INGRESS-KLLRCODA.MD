==================================================
Kubernetes Ingress Lab â€” Killercoda Edition
==================================================

### *(Supports HTTP + HTTPS + Path-Based + Host-Based Routing)*

---

## âš™ï¸ Lab Objective

Students will:

1. Deploy four simple NGINX services (`sample-1` â†’ `sample-4`)
2. Install the NGINX Ingress Controller
3. Configure and test Ingress for both HTTP and HTTPS
4. Observe routing behavior for path- and host-based rules

---
NB:
Use same deployment, services, ingress and selfsigned-cert files as for minikube

Pre-req
1- Ingress installation for KLLRCODA is different than minikube mention in step 2
2- 





## ğŸ§© Step 1 â€” Verify Cluster Access

```bash
kubectl get nodes
```

âœ… *Expected:*

```
controlplane   Ready   control-plane
node01         Ready
```

---

## ğŸ§© Step 2 â€” Install NGINX Ingress Controller

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```

### ğŸ”¹ Show / Verify

```bash
kubectl get pods -n ingress-nginx
kubectl get svc  -n ingress-nginx
```

âœ… *Wait until:*

```
ingress-nginx-controller   1/1   Running
```

---

## ğŸ§© Step 3 â€” Deploy Four Sample Apps (deployment and services)

kubectl apply -f sample-1-deployment.yaml

kubectl apply -f sample-2-deployment.yaml

kubectl apply -f sample-3.deployment.yaml

kubectl apply -f sample-4.deployment.yaml

kubectl apply -f sample-1-services.yaml

kubectl apply -f sample-2-services.yaml

kubectl apply -f sample-3-services.yaml

kubectl apply -f sample-4-services.yaml
```

### ğŸ”¹ Show / Verify

```bash
kubectl get deploy,svc
```

âœ… *Expected:* four deployments and four services appear.

---

## ğŸ§© Step 4 â€” Create Self-Signed TLS Certificate

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=devopsdummies.com/O=devopsdummies"
```

### ğŸ”¹ Create K8s Secret

```bash
kubectl create secret tls tls-secret --cert=tls.crt --key=tls.key

kubectl get secret tls-secret
```

âœ… *Expected:* `TYPE: kubernetes.io/tls`

---

## ğŸ§© Step 5 â€” Create the Ingress Resource


kubectl apply -f ingress-resource.yaml
```

### ğŸ”¹ Show / Verify

kubectl get ingress

kubectl describe ingress example-ingress


âœ… *Expected:* lists all 4 rules and the `tls-secret`.

---

## ğŸ§© Step 6 â€” Find NodePorts for HTTP & HTTPS

```bash
kubectl get svc -n ingress-nginx
```

Example output:

```
80:32225/TCP,443:31046/TCP
```

â¡ **HTTP Port = 32225**, **HTTPS Port = 31046**

---

## ğŸ§© Step 7 â€” Test HTTP Routing

### ğŸ”¹ Path-based
NB: Your port may be different so change following commands port as per output to your terminal
```bash
curl -v -H "Host: devopsdummies.com" http://localhost:32225/sample-1

curl -v -H "Host: devopsdummies.com" http://localhost:32225/sample-2
```

### ğŸ”¹ Host-based
NB: Your port may be different so change following commands port as per output to your terminal
```bash
curl -v -H "Host: sample-3.devopsdummies.com" http://localhost:32225/

curl -v -H "Host: sample-4.devopsdummies.com" http://localhost:32225/
```

âœ… *Expected:* NGINX welcome page.

---

## ğŸ§© Step 8 â€” Test HTTPS Routing (Self-Signed)

### ğŸ”¹ Path-based
NB: Your port may be different so change following commands port as per output to your terminal
```bash
curl -vk -H "Host: devopsdummies.com" https://localhost:31046/sample-1

curl -vk -H "Host: devopsdummies.com" https://localhost:31046/sample-2
```

### ğŸ”¹ Host-based

NB: Your port may be different so change following commands port as per output to your terminal
```bash
curl -vk -H "Host: sample-3.devopsdummies.com" https://localhost:31046/

curl -vk -H "Host: sample-4.devopsdummies.com" https://localhost:31046/
```

âœ… *Expected:* same HTML, with `SSL certificate verify result: self signed certificate`.

---

## ğŸ§© Step 9 â€” (Verify Certificate)

```bash
echo | openssl s_client -connect localhost:31046 -servername devopsdummies.com | openssl x509 -noout -subject -issuer
```

âœ… *Expected:*

```
subject=CN = devopsdummies.com

issuer=CN = devopsdummies.com
```

---

## ğŸ§© Step 10 â€” Optional : Check Logs to See Routing

```bash
kubectl get pods -o wide
kubectl logs -l app=sample-3
kubectl logs -l app=sample-4
```

Youâ€™ll see NGINX access logs confirming which backend served the request.

---

## âœ… Lab Summary

| Feature            | Verified with                                              |
| ------------------ | ---------------------------------------------------------- |
| Ingress Controller | `kubectl get pods -n ingress-nginx`                        |
| Path-based routing | `/sample-1`, `/sample-2`                                   |
| Host-based routing | `sample-3.devopsdummies.com`, `sample-4.devopsdummies.com` |
| HTTP + HTTPS       | Ports 32225 and 31046                                      |
| No forced redirect | `ssl-redirect: false`                                      |

---

### ğŸ’¡ Cleanup (optional)

```bash
kubectl delete ingress example-ingress
kubectl delete all -l app=sample-1
kubectl delete all -l app=sample-2
kubectl delete all -l app=sample-3
kubectl delete all -l app=sample-4
kubectl delete secret tls-secret
```

---

Thatâ€™s the **complete, ready-to-teach Killercoda lab** â€” fully tested, self-contained, and understandable for beginners.
Would you like me to format this into a downloadable **Markdown (.md)** or **Word (.docx)** file for easy sharing with your students?
